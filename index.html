<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EDUKIDS üßíüî¢ - Aprende con Operaciones</title>
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      min-height: 100vh;
      width: 100vw;
      min-width: 100vw;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      overflow-x: hidden;
      background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 25%, #fecfef 50%, #ff9a9e 75%, #ff9a9e 100%);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      position: relative;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      min-width: 100vw;
      width: 100vw;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      font-family: 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
    }

    /* Elementos flotantes animados */
    .floating-elements {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .floating-element {
      position: absolute;
      font-size: 2em;
      animation: float 20s linear infinite;
      opacity: 0.7;
    }

    @keyframes float {
      0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(-10vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* Contenedor principal */
    .container {
      position: relative;
      width: 100%;
      max-width: 800px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      z-index: 10;
    }

    .screen {
      width: 100%;
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    /* Pantalla de registro */
    .register-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 500px;
      width: 100%;
      animation: bounceIn 1s ease-out;
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.3) rotate(-10deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.05) rotate(2deg);
      }
      70% {
        transform: scale(0.9) rotate(-1deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .logo-container {
      margin-bottom: 30px;
    }

    .logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 15px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: coinGlow 2s ease-in-out infinite alternate;
    }

    @keyframes coinGlow {
      0% {
        box-shadow: 0 10px 25px rgba(255, 193, 7, 0.4);
        transform: rotate(0deg);
      }
      100% {
        box-shadow: 0 15px 35px rgba(255, 193, 7, 0.8);
        transform: rotate(5deg);
      }
    }

    .edukids-title {
      font-size: 3em;
      margin: 0;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
      background-size: 400% 400%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 3s ease infinite;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
      font-size: 1.2em;
      color: #666;
      margin: 10px 0 30px 0;
      font-weight: 600;
    }

    .register-form {
      text-align: left;
    }

    .input-group {
      margin-bottom: 25px;
    }

    .input-group label {
      display: block;
      font-size: 1.3em;
      color: #333;
      margin-bottom: 8px;
      font-weight: bold;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 15px 20px;
      font-size: 1.2em;
      border: 3px solid #e0e0e0;
      border-radius: 15px;
      background: #f9f9f9;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #4ecdc4;
      background: white;
      box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
      transform: translateY(-2px);
    }

    .start-btn {
      width: 100%;
      padding: 18px;
      font-size: 1.4em;
      font-weight: bold;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }

    .start-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
    }

    .start-btn:active {
      transform: translateY(-1px);
    }

    .start-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .start-btn.ready {
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* Pantalla de juego */
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 600px;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px 25px;
      border-radius: 20px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .player-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .player-name {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
    }

    .level-badge {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9em;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .score-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .coins {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.3em;
      font-weight: bold;
      color: #f39c12;
    }    .coin-icon {
      width: 24px;
      height: 24px;
      animation: coinGlow 2s ease-in-out infinite alternate;
      filter: drop-shadow(0 2px 4px rgba(255, 178, 0, 0.3));
    }
    
    .coin-icon-img {
      width: 20px;
      height: 20px;
      vertical-align: middle;
      animation: coinGlow 2s ease-in-out infinite alternate;
      filter: drop-shadow(0 2px 4px rgba(255, 178, 0, 0.3));
    }

    .hearts {
      font-size: 1.5em;
    }

    /* √Årea de pregunta */
    .question-area {
      width: 100%;
      max-width: 600px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 25px;
      padding: 40px;
      margin: 20px 0;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      text-align: center;
    }

    .question-container {
      margin-bottom: 30px;
    }

    .operation-display {
      font-size: 3em;
      font-weight: bold;
      color: #333;
      margin-bottom: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: bounceIn 0.8s ease-out;
    }

    .combo-indicator {
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 1.2em;
      font-weight: bold;
      display: inline-block;
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
      animation: pulse 1s ease-in-out infinite;
    }

    .answer-input {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    #answerInput {
      flex: 1;
      min-width: 200px;
      padding: 15px 20px;
      font-size: 1.5em;
      text-align: center;
      border: 3px solid #e0e0e0;
      border-radius: 15px;
      background: #f9f9f9;
      transition: all 0.3s ease;
    }

    #answerInput:focus {
      outline: none;
      border-color: #4ecdc4;
      background: white;
      box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
    }

    .answer-btn {
      padding: 15px 25px;
      font-size: 1.2em;
      font-weight: bold;
      background: linear-gradient(45deg, #4ecdc4, #44a08d);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(78, 205, 196, 0.3);
    }

    .answer-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(78, 205, 196, 0.4);
    }

    /* Opciones m√∫ltiples */
    .options-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      width: 100%;
      max-width: 400px;
      margin: 20px auto;
    }

    .option-btn {
      padding: 20px;
      font-size: 1.5em;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .option-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }

    .option-btn.selected {
      background: linear-gradient(135deg, #4ecdc4, #44a08d);
      transform: scale(1.05);
    }

    .option-btn.correct {
      background: linear-gradient(135deg, #4CAF50, #8BC34A);
      animation: success-glow 1s ease-out;
    }

    .option-btn.incorrect {
      background: linear-gradient(135deg, #F44336, #FF5722);
      animation: error-shake 0.5s ease-out;
    }

    @keyframes success-glow {
      0% { box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3); }
      50% { box-shadow: 0 15px 40px rgba(76, 175, 80, 0.6); }
      100% { box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3); }
    }

    @keyframes error-shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Botones de control */
    .control-buttons {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .control-btn {
      padding: 12px 20px;
      font-size: 1.1em;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }

    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .reset-btn {
      background: linear-gradient(135deg, #F44336, #FF5722);
      box-shadow: 0 6px 20px rgba(244, 67, 54, 0.3);
    }

    .reset-btn:hover {
      box-shadow: 0 8px 25px rgba(244, 67, 54, 0.4);
    }

    /* Barra de progreso */
    .progress-container {
      width: 100%;
      max-width: 500px;
      margin: 20px 0;
    }

    .progress-bar {
      width: 100%;
      height: 15px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4ecdc4, #44a08d);
      border-radius: 10px;
      transition: width 0.5s ease;
      box-shadow: 0 2px 10px rgba(78, 205, 196, 0.4);
    }

    .progress-text {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
      color: #333;
      font-size: 1.1em;
      background: rgba(255, 255, 255, 0.8);
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
    }

    /* Pantalla de perfil */
    .profile-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    .profile-container h2 {
      font-size: 2.5em;
      margin-bottom: 30px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .profile-stats {
      text-align: left;
      margin-bottom: 30px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 2px solid #f0f0f0;
      font-size: 1.2em;
    }

    .stat-label {
      font-weight: bold;
      color: #333;
    }    .stat-value {
      color: #667eea;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .stat-value .coin-icon {
      font-size: 1.2em;
      animation: coinGlow 2s ease-in-out infinite alternate;
    }

    .profile-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Mensajes de feedback */
    .feedback-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: white;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
      z-index: 10000;
      opacity: 0;
      transition: all 0.3s ease;
      max-width: 400px;
    }

    .feedback-message.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .feedback-message.success {
      background: linear-gradient(135deg, #4CAF50, #8BC34A);
      color: white;
    }

    .feedback-message.error {
      background: linear-gradient(135deg, #F44336, #FF5722);
      color: white;
    }

    .feedback-message.warning {
      background: linear-gradient(135deg, #FF9800, #FFC107);
      color: white;
    }

    .feedback-message.info {
      background: linear-gradient(135deg, #2196F3, #03A9F4);
      color: white;
    }

    /* Mensaje de subida de nivel */
    .level-up-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(135deg, #9C27B0, #E91E63);
      color: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      text-align: center;
      z-index: 10000;
      opacity: 0;
      transition: all 0.5s ease;
      max-width: 400px;
    }

    .level-up-message.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      animation: celebration 0.8s ease-out;
    }

    @keyframes celebration {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); }
      50% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    }

    .level-up-content h2 {
      margin: 0 0 15px 0;
      font-size: 2em;
    }

    .level-up-content p {
      margin: 8px 0;
      font-size: 1.2em;
    }

    /* Part√≠culas m√°gicas */
    .magic-particle {
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 1000;
      animation: magicFloat 3s ease-out forwards;
    }

    @keyframes magicFloat {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-100px) scale(1.5);
      }
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      
      .register-container,
      .question-area,
      .profile-container {
        padding: 25px;
      }
      
      .edukids-title {
        font-size: 2.2em;
      }
      
      .operation-display {
        font-size: 2em;
      }
      
      .game-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .answer-input {
        flex-direction: column;
      }
      
      #answerInput {
        min-width: auto;
        width: 100%;
      }
      
      .control-buttons {
        justify-content: center;
      }
      
      .profile-actions {
        flex-direction: column;
      }
    }

    @media (max-width: 400px) {
      .edukids-title {
        font-size: 1.8em;
      }
      
      .operation-display {
        font-size: 1.5em;
      }
      
      .options-container {
        grid-template-columns: 1fr;
      }
      
      .feedback-message,
      .level-up-message {
        margin: 0 20px;
        max-width: calc(100% - 40px);
      }
    }
  </style>
</head>
<body>
  <div class="floating-elements"></div>
  
  <div class="container" id="container">
    <!-- Pantalla de Registro -->
    <div class="screen" id="registerScreen">
      <div class="register-container">
        <div class="logo-container">
          <img src="logo_edu.png" alt="EDUKIDS Logo" class="logo">
          <h1 class="edukids-title">üßí EDUKIDS üî¢</h1>
          <p class="subtitle">¬°Aprende matem√°ticas mientras te diviertes!</p>
        </div>
        
        <div class="register-form">
          <div class="input-group">
            <label for="kidName">¬øC√≥mo te llamas?</label>
            <input type="text" id="kidName" placeholder="Escribe tu nombre aqu√≠" maxlength="20">
          </div>
          
          <div class="input-group">
            <label for="kidAge">¬øCu√°ntos a√±os tienes?</label>
            <select id="kidAge">
              <option value="">Selecciona tu edad</option>
              <option value="5">5 a√±os</option>
              <option value="6">6 a√±os</option>
              <option value="7">7 a√±os</option>
              <option value="8">8 a√±os</option>
              <option value="9">9 a√±os</option>
              <option value="10">10 a√±os</option>
              <option value="11">11 a√±os</option>
              <option value="12">12 a√±os</option>
            </select>
          </div>
          
          <button type="button" id="startGameBtn" class="start-btn" disabled>
            <span>üöÄ ¬°Empezar a Jugar! üöÄ</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Pantalla Principal del Juego -->
    <div class="screen" id="gameScreen" style="display: none;">
      <!-- Header del Juego -->
      <div class="game-header">
        <div class="player-info">
          <span class="player-name" id="playerName">üë¶ </span>
          <div class="level-badge">
            <span>Nivel <span id="currentLevel">1</span></span>
          </div>
        </div>
        
        <div class="score-info">        <div class="coins">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIGZpbGw9IiNGRkQ3MDAiIHN0cm9rZT0iI0ZGQjAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik05IDEyaDZNMTIgOXY2IiBzdHJva2U9IiNGRkIwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjx0ZXh0IHg9IjEyIiB5PSIxNyIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEwIiBmb250LXdlaWdodD0iYm9sZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI0ZGQjAwMCI+JDwvdGV4dD4KPC9zdmc+" alt="üí∞" class="coin-icon">
            <span id="totalCoins">0</span>
          </div>
          <div class="hearts">
            <span id="heartsContainer">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
          </div>
        </div>
      </div>

      <!-- √Årea de Pregunta -->
      <div class="question-area">
        <div class="question-container">
          <div class="operation-display">
            <span id="questionText">2 + 3 = ?</span>
          </div>
          
          <div class="combo-indicator" id="comboIndicator" style="display: none;">
            <span>üî• Combo x<span id="comboCount">1</span></span>
          </div>
        </div>
        
        <div class="answer-input">
          <input type="number" id="answerInput" placeholder="¬øCu√°l es la respuesta?" autocomplete="off">
          <button type="button" id="submitAnswer" class="answer-btn">
            ‚úÖ Responder
          </button>
        </div>
      </div>

      <!-- Opciones de Respuesta (para modo m√∫ltiple opci√≥n) -->
      <div class="options-container" id="optionsContainer" style="display: none;">
        <button class="option-btn" data-value=""></button>
        <button class="option-btn" data-value=""></button>
        <button class="option-btn" data-value=""></button>
        <button class="option-btn" data-value=""></button>
      </div>

      <!-- Botones de Control -->
      <div class="control-buttons">
        <button type="button" id="hintBtn" class="control-btn">
          üí° Pista
        </button>
        <button type="button" id="skipBtn" class="control-btn">
          ‚è≠Ô∏è Saltar
        </button>
        <button type="button" id="profileBtn" class="control-btn">
          üë§ Perfil
        </button>
      </div>

      <!-- Progreso del Nivel -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
          <span id="progressText">Pregunta 1 de 10</span>
        </div>
      </div>
    </div>

    <!-- Pantalla de Perfil -->
    <div class="screen" id="profileScreen" style="display: none;">
      <div class="profile-container">
        <h2>üë§ Mi Perfil</h2>
        
        <div class="profile-stats">
          <div class="stat-item">
            <span class="stat-label">Nombre:</span>
            <span class="stat-value" id="profileName">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Edad:</span>
            <span class="stat-value" id="profileAge">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Nivel Actual:</span>
            <span class="stat-value" id="profileLevel">1</span>
          </div>          <div class="stat-item">
            <span class="stat-label">Total de Monedas:</span>
            <span class="stat-value"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIGZpbGw9IiNGRkQ3MDAiIHN0cm9rZT0iI0ZGQjAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik05IDEyaDZNMTIgOXY2IiBzdHJva2U9IiNGRkIwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjx0ZXh0IHg9IjEyIiB5PSIxNyIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEwIiBmb250LXdlaWdodD0iYm9sZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI0ZGQjAwMCI+JDwvdGV4dD4KPC9zdmc+" alt="üí∞" class="coin-icon-img"> <span id="profileCoins">0</span></span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Respuestas Correctas:</span>
            <span class="stat-value" id="profileCorrect">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total de Preguntas:</span>
            <span class="stat-value" id="profileTotal">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Precisi√≥n:</span>
            <span class="stat-value" id="profileAccuracy">0%</span>
          </div>
        </div>
        
        <div class="profile-actions">
          <button type="button" id="backToGameBtn" class="control-btn">
            üéÆ Volver al Juego
          </button>
          <button type="button" id="resetProgressBtn" class="control-btn reset-btn">
            üîÑ Reiniciar Progreso
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Elementos de Feedback -->
  <div id="feedbackMessage" class="feedback-message"></div>
  <div id="levelUpMessage" class="level-up-message"></div>

  <script>
    // === VARIABLES GLOBALES ===
    let gameState = {
      playerName: '',
      playerAge: 0,
      currentLevel: 1,
      currentQuestion: 1,
      questionsPerLevel: 10,
      hearts: 3,
      coins: 0,
      combo: 0,
      correctAnswers: 0,
      totalQuestions: 0,
      currentAnswer: 0,
      questionType: 'addition',
      difficulty: 1,
      isMultipleChoice: false
    };

    let currentQuestion = {
      num1: 0,
      num2: 0,
      operation: '+',
      answer: 0,
      options: []
    };

    // === ELEMENTOS DEL DOM ===
    const screens = {
      register: document.getElementById('registerScreen'),
      game: document.getElementById('gameScreen'),
      profile: document.getElementById('profileScreen')
    };

    const elements = {
      kidName: document.getElementById('kidName'),
      kidAge: document.getElementById('kidAge'),
      startGameBtn: document.getElementById('startGameBtn'),
      playerName: document.getElementById('playerName'),
      currentLevel: document.getElementById('currentLevel'),
      totalCoins: document.getElementById('totalCoins'),
      heartsContainer: document.getElementById('heartsContainer'),
      questionText: document.getElementById('questionText'),
      answerInput: document.getElementById('answerInput'),
      submitAnswer: document.getElementById('submitAnswer'),
      optionsContainer: document.getElementById('optionsContainer'),
      comboIndicator: document.getElementById('comboIndicator'),
      comboCount: document.getElementById('comboCount'),
      progressFill: document.getElementById('progressFill'),
      progressText: document.getElementById('progressText'),
      hintBtn: document.getElementById('hintBtn'),
      skipBtn: document.getElementById('skipBtn'),
      profileBtn: document.getElementById('profileBtn'),
      backToGameBtn: document.getElementById('backToGameBtn'),
      resetProgressBtn: document.getElementById('resetProgressBtn'),
      feedbackMessage: document.getElementById('feedbackMessage'),
      levelUpMessage: document.getElementById('levelUpMessage')
    };

    // === INICIALIZACI√ìN ===
    document.addEventListener('DOMContentLoaded', function() {
      loadGameData();
      setupEventListeners();
      createFloatingElements();
      
      // Si ya hay datos guardados, ir directamente al juego
      if (gameState.playerName) {
        showScreen('game');
        updateUI();
        generateNewQuestion();
      }
    });

    function setupEventListeners() {
      // Bot√≥n de comenzar juego
      elements.startGameBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        startGame();
      });
      
      // Input de respuesta
      elements.answerInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkAnswer();
        }
      });
      
      // Bot√≥n de enviar respuesta
      elements.submitAnswer.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        checkAnswer();
      });
      
      // Botones de control
      elements.hintBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        showHint();
      });
      elements.skipBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        skipQuestion();
      });
      elements.profileBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        showScreen('profile');
      });
      elements.backToGameBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        showScreen('game');
      });
      elements.resetProgressBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        resetProgress();
      });
      
      // Opciones m√∫ltiples
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          selectOption(parseInt(this.dataset.value));
        });
      });
      
      // Validaci√≥n en tiempo real del formulario
      elements.kidName.addEventListener('input', validateForm);
      elements.kidAge.addEventListener('change', validateForm);
    }

    // === GESTI√ìN DE PANTALLAS ===
    function showScreen(screenName) {
      Object.values(screens).forEach(screen => screen.style.display = 'none');
      screens[screenName].style.display = 'block';
      
      if (screenName === 'profile') {
        updateProfileStats();
      }    }

    // === L√ìGICA DEL JUEGO ===
    function startGame() {
      const name = elements.kidName.value.trim();
      const age = parseInt(elements.kidAge.value);
      
      if (!name || !age) {
        showFeedback('‚ö†Ô∏è Por favor completa todos los campos', 'warning');
        return;
      }
      
      gameState.playerName = name;
      gameState.playerAge = age;
      gameState.difficulty = Math.max(1, Math.floor(age / 2) - 1);
        updateUI();
      saveGameData();
      showScreen('game');
      
      // Mostrar mensaje de bienvenida con informaci√≥n del nivel 1
      setTimeout(() => {
        showFeedback(`¬°Hola ${name}! üéâ Comenzaremos con SUMAS ‚ûï. Ejemplo: 2 + 3 = ?`, 'success');
      }, 500);
      
      setTimeout(() => {
        generateNewQuestion();
      }, 2000);
    }
    
    function generateNewQuestion() {
      // Determinar tipo de operaci√≥n basado en nivel y edad
      const operations = getAvailableOperations();
      const operation = operations[Math.floor(Math.random() * operations.length)];
      currentQuestion.operation = operation;
      
      // Determinar si usar opci√≥n m√∫ltiple
      gameState.isMultipleChoice = gameState.currentLevel > 2 && Math.random() < 0.3;
      
      // Generar n√∫meros seg√∫n operaci√≥n espec√≠fica
      if (operation === '√∑') {
        // Para divisi√≥n: generar dividendo que sea m√∫ltiplo del divisor
        const level = gameState.currentLevel;
        let maxDivisor, maxResult;
        
        if (level <= 2) { maxDivisor = 5; maxResult = 5; }
        else if (level <= 4) { maxDivisor = 10; maxResult = 10; }
        else if (level <= 6) { maxDivisor = 12; maxResult = 12; }
        else { maxDivisor = 15; maxResult = 15; }
        
        currentQuestion.num2 = Math.floor(Math.random() * (maxDivisor - 2)) + 2;
        currentQuestion.answer = Math.floor(Math.random() * maxResult) + 1;
        currentQuestion.num1 = currentQuestion.num2 * currentQuestion.answer;
        
      } else if (operation === '√ó') {
        // Para multiplicaci√≥n: n√∫meros m√°s peque√±os
        const level = gameState.currentLevel;
        let maxNum;
        
        if (level <= 2) maxNum = 5;
        else if (level <= 4) maxNum = 10;
        else if (level <= 6) maxNum = 12;
        else maxNum = 15;
        
        currentQuestion.num1 = Math.floor(Math.random() * (maxNum - 1)) + 1;
        currentQuestion.num2 = Math.floor(Math.random() * (maxNum - 1)) + 1;
        currentQuestion.answer = currentQuestion.num1 * currentQuestion.num2;
        
      } else {
        // Para suma y resta: rangos normales
        const range = getDifficultyRange();
        currentQuestion.num1 = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        currentQuestion.num2 = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        
        if (operation === '+') {
          currentQuestion.answer = currentQuestion.num1 + currentQuestion.num2;
        } else if (operation === '-') {
          // Asegurar que el resultado sea positivo
          if (currentQuestion.num1 < currentQuestion.num2) {
            [currentQuestion.num1, currentQuestion.num2] = [currentQuestion.num2, currentQuestion.num1];
          }
          currentQuestion.answer = currentQuestion.num1 - currentQuestion.num2;
        }
      }
      
      // Mostrar pregunta
      elements.questionText.textContent = `${currentQuestion.num1} ${currentQuestion.operation} ${currentQuestion.num2} = ?`;
      
      // Configurar interfaz
      if (gameState.isMultipleChoice) {
        setupMultipleChoice();
        elements.answerInput.style.display = 'none';
        elements.submitAnswer.style.display = 'none';
        elements.optionsContainer.style.display = 'grid';
      } else {
        elements.answerInput.style.display = 'block';
        elements.submitAnswer.style.display = 'block';
        elements.optionsContainer.style.display = 'none';
        elements.answerInput.value = '';
        elements.answerInput.focus();
      }
        updateProgressBar();
      addQuestionAnimation();
    }
    
    function getAvailableOperations() {
      const level = gameState.currentLevel;
      
      // Progresi√≥n por niveles espec√≠ficos
      if (level === 1) return ['+'];                    // Nivel 1: Solo sumas
      if (level === 2) return ['-'];                    // Nivel 2: Solo restas  
      if (level === 3) return ['√ó'];                    // Nivel 3: Solo multiplicaci√≥n
      if (level === 4) return ['√∑'];                    // Nivel 4: Solo divisi√≥n
      return ['+', '-', '√ó', '√∑'];                      // Nivel 5+: Todas las operaciones
    }

    function getDifficultyRange() {
      const level = gameState.currentLevel;
      const age = gameState.playerAge;
      
      if (level <= 2) return { min: 1, max: 10 };
      if (level <= 4) return { min: 1, max: 20 };
      if (level <= 6) return { min: 1, max: 50 };
      if (level <= 8) return { min: 10, max: 100 };
      return { min: 10, max: 200 };
    }

    function setupMultipleChoice() {
      const correctAnswer = currentQuestion.answer;
      const options = [correctAnswer];
      
      // Generar opciones incorrectas
      while (options.length < 4) {
        let wrongAnswer;
        if (correctAnswer <= 10) {
          wrongAnswer = correctAnswer + (Math.floor(Math.random() * 10) - 5);
        } else {
          wrongAnswer = correctAnswer + (Math.floor(Math.random() * 20) - 10);
        }
        
        if (wrongAnswer > 0 && !options.includes(wrongAnswer)) {
          options.push(wrongAnswer);
        }
      }
      
      // Mezclar opciones
      shuffleArray(options);
      currentQuestion.options = options;
      
      // Actualizar botones
      const optionBtns = document.querySelectorAll('.option-btn');
      optionBtns.forEach((btn, index) => {        btn.textContent = options[index];
        btn.dataset.value = options[index];
        btn.classList.remove('selected', 'correct', 'incorrect');
      });
    }
    
    function selectOption(value) {
      // Remover selecci√≥n anterior
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // Seleccionar nueva opci√≥n - encontrar el bot√≥n correcto
      document.querySelectorAll('.option-btn').forEach(btn => {
        if (parseInt(btn.dataset.value) === value) {
          btn.classList.add('selected');
        }
      });
      
      // Verificar respuesta despu√©s de un peque√±o delay
      setTimeout(() => {
        const isCorrect = value === currentQuestion.answer;
        processAnswer(isCorrect, value);
      }, 500);
    }

    function checkAnswer() {
      const userAnswer = parseInt(elements.answerInput.value);
      
      if (isNaN(userAnswer)) {
        showFeedback('‚ö†Ô∏è Por favor ingresa un n√∫mero v√°lido', 'warning');
        return;
      }
      
      const isCorrect = userAnswer === currentQuestion.answer;
      processAnswer(isCorrect, userAnswer);
    }

    function processAnswer(isCorrect, userAnswer) {
      gameState.totalQuestions++;
      
      if (isCorrect) {
        handleCorrectAnswer();
      } else {
        handleIncorrectAnswer(userAnswer);
      }
      
      updateUI();
      saveGameData();
      
      // Continuar al siguiente paso
      setTimeout(() => {
        nextQuestion();
      }, 2000);
    }

    function handleCorrectAnswer() {
      gameState.correctAnswers++;
      gameState.combo++;
      
      // Calcular monedas ganadas
      let coinsEarned = 10;
      if (gameState.combo > 1) {
        coinsEarned += gameState.combo * 5;
      }
      if (gameState.isMultipleChoice) {
        coinsEarned += 5;
      }
      
      gameState.coins += coinsEarned;
      
      // Mostrar feedback
      const messages = [
        '¬°Excelente! üéâ',
        '¬°Muy bien! ‚≠ê',
        '¬°Correcto! üéä',
        '¬°Fant√°stico! üåü',
        '¬°Genial! üéà'
      ];
      
      let message = messages[Math.floor(Math.random() * messages.length)];
      if (gameState.combo > 1) {
        message += ` Combo x${gameState.combo}! üî•`;
      }
      message += ` +${coinsEarned} monedas üí∞`;
      
      showFeedback(message, 'success');
      
      // Efectos visuales
      createParticleEffect('success');
      if (gameState.combo > 1) {
        showComboIndicator();
      }
      
      // Marcar opci√≥n correcta si es opci√≥n m√∫ltiple
      if (gameState.isMultipleChoice) {
        document.querySelectorAll('.option-btn').forEach(btn => {
          if (parseInt(btn.dataset.value) === currentQuestion.answer) {
            btn.classList.add('correct');
          }
        });
      }
    }

    function handleIncorrectAnswer(userAnswer) {
      gameState.combo = 0;
      gameState.hearts = Math.max(0, gameState.hearts - 1);
      
      // Mostrar respuesta correcta
      let message = `‚ùå Incorrecto. La respuesta era ${currentQuestion.answer}`;
      showFeedback(message, 'error');
      
      // Efectos visuales
      createParticleEffect('error');
      hideComboIndicator();
      
      // Marcar opciones si es opci√≥n m√∫ltiple
      if (gameState.isMultipleChoice) {
        document.querySelectorAll('.option-btn').forEach(btn => {
          const value = parseInt(btn.dataset.value);
          if (value === currentQuestion.answer) {
            btn.classList.add('correct');
          } else if (value === userAnswer) {
            btn.classList.add('incorrect');
          }
        });
      }
      
      // Verificar game over
      if (gameState.hearts <= 0) {
        setTimeout(() => {
          gameOver();
        }, 2000);
        return;
      }
    }

    function nextQuestion() {
      gameState.currentQuestion++;
      
      // Verificar si complet√≥ el nivel
      if (gameState.currentQuestion > gameState.questionsPerLevel) {
        levelUp();
        return;
      }
      
      generateNewQuestion();
    }    function levelUp() {
      gameState.currentLevel++;
      gameState.currentQuestion = 1;
      gameState.hearts = Math.min(5, gameState.hearts + 1); // Recuperar coraz√≥n, m√°ximo 5
      
      const bonusCoins = gameState.currentLevel * 50;
      gameState.coins += bonusCoins;
      
      showLevelUpMessage();
      updateUI();
      saveGameData();
      
      // Generar nueva pregunta con la operaci√≥n del nuevo nivel despu√©s del mensaje
      setTimeout(() => {
        generateNewQuestion();
      }, 4000); // M√°s tiempo para leer el mensaje
    }

    function gameOver() {
      const accuracy = Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100);
      let message = `üéÆ ¬°Fin del juego!\n\n`;
      message += `Nivel alcanzado: ${gameState.currentLevel}\n`;
      message += `Monedas ganadas: ${gameState.coins} üí∞\n`;
      message += `Precisi√≥n: ${accuracy}%\n\n`;
      message += `¬°Sigue practicando para mejorar! üí™`;
      
      alert(message);
      
      // Reiniciar algunos valores pero mantener el progreso
      gameState.hearts = 3;
      gameState.currentQuestion = 1;
      gameState.combo = 0;
      
      updateUI();
      generateNewQuestion();
    }

    // === FUNCIONES DE AYUDA ===
    function showHint() {
      if (gameState.coins < 20) {
        showFeedback('üí∞ Necesitas 20 monedas para comprar una pista', 'warning');
        return;
      }
      
      gameState.coins -= 20;
      updateUI();
      saveGameData();
      
      let hint = '';
      const answer = currentQuestion.answer;
      const operation = currentQuestion.operation;
      const num1 = currentQuestion.num1;
      const num2 = currentQuestion.num2;
      
      // Pistas espec√≠ficas seg√∫n el tipo de operaci√≥n
      switch (operation) {
        case '+':
          if (answer <= 10) {
            hint = `üí° Pista: ${num1} + ${num2}. Cuenta hacia adelante desde ${num1}, ${num2} veces`;
          } else if (answer <= 20) {
            hint = `üí° Pista: La suma est√° entre ${answer - 3} y ${answer + 3}`;
          } else {
            hint = `üí° Pista: Suma las decenas: ${Math.floor(num1/10)*10} + ${Math.floor(num2/10)*10}, luego las unidades`;
          }
          break;
          
        case '-':
          if (answer <= 10) {
            hint = `üí° Pista: ${num1} - ${num2}. Cuenta hacia atr√°s desde ${num1}, ${num2} veces`;
          } else if (answer <= 20) {
            hint = `üí° Pista: La resta est√° entre ${answer - 3} y ${answer + 3}`;
          } else {
            hint = `üí° Pista: ¬øQu√© n√∫mero sumado a ${num2} da ${num1}?`;
          }
          break;
          
        case '√ó':
          if (num1 <= 5 && num2 <= 5) {
            hint = `üí° Pista: ${num1} √ó ${num2} = ${num1} sumado ${num2} veces`;
          } else if (num1 <= 10 && num2 <= 10) {
            hint = `üí° Pista: Tabla del ${Math.min(num1, num2)}. La respuesta est√° entre ${answer - 5} y ${answer + 5}`;
          } else {
            hint = `üí° Pista: ${num1} √ó ${num2}. Multiplica las decenas primero`;
          }
          break;
          
        case '√∑':
          if (num1 <= 50) {
            hint = `üí° Pista: ${num1} √∑ ${num2}. ¬øCu√°ntas veces cabe ${num2} en ${num1}?`;
          } else {
            hint = `üí° Pista: ${num1} √∑ ${num2}. Piensa: ${num2} √ó ? = ${num1}`;
          }
          break;
          
        default:
          // Pista general por si acaso
          if (answer <= 10) {
            hint = `üí° Pista: La respuesta est√° entre ${Math.max(1, answer - 2)} y ${answer + 2}`;
          } else if (answer <= 100) {
            hint = `üí° Pista: La respuesta est√° entre ${Math.max(1, answer - 10)} y ${answer + 10}`;
          } else {
            hint = `üí° Pista: La respuesta tiene ${answer.toString().length} d√≠gitos`;
          }
      }
      
      showFeedback(hint, 'info');
    }

    function skipQuestion() {
      if (gameState.coins < 30) {
        showFeedback('üí∞ Necesitas 30 monedas para saltar una pregunta', 'warning');
        return;
      }
      
      gameState.coins -= 30;
      gameState.combo = 0;
      updateUI();
      saveGameData();
      
      showFeedback('‚è≠Ô∏è Pregunta saltada. -30 monedas', 'info');
      hideComboIndicator();
      
      setTimeout(() => {
        nextQuestion();
      }, 1000);
    }

    // === ACTUALIZACI√ìN DE UI ===
    function updateUI() {
      elements.playerName.textContent = `üë¶ ${gameState.playerName}`;
      elements.currentLevel.textContent = gameState.currentLevel;
      elements.totalCoins.textContent = gameState.coins;
      updateHearts();
      updateProgressBar();
    }

    function updateHearts() {
      const heartsFull = '‚ù§Ô∏è'.repeat(gameState.hearts);
      const heartsEmpty = 'ü§ç'.repeat(Math.max(0, 5 - gameState.hearts));
      elements.heartsContainer.textContent = heartsFull + heartsEmpty;
    }

    function updateProgressBar() {
      const progress = ((gameState.currentQuestion - 1) / gameState.questionsPerLevel) * 100;
      elements.progressFill.style.width = `${progress}%`;
      elements.progressText.textContent = `Pregunta ${gameState.currentQuestion} de ${gameState.questionsPerLevel}`;
    }

    function showComboIndicator() {
      elements.comboCount.textContent = gameState.combo;
      elements.comboIndicator.style.display = 'block';
      elements.comboIndicator.classList.add('pulse');
    }

    function hideComboIndicator() {
      elements.comboIndicator.style.display = 'none';
      elements.comboIndicator.classList.remove('pulse');
    }    function updateProfileStats() {
      // Actualizar elementos del perfil de forma segura
      const profileNameEl = document.getElementById('profileName');
      const profileAgeEl = document.getElementById('profileAge');
      const profileLevelEl = document.getElementById('profileLevel');
      const profileCoinsEl = document.getElementById('profileCoins');
      const profileCorrectEl = document.getElementById('profileCorrect');
      const profileTotalEl = document.getElementById('profileTotal');
      const profileAccuracyEl = document.getElementById('profileAccuracy');
      
      if (profileNameEl) profileNameEl.textContent = gameState.playerName || '-';
      if (profileAgeEl) profileAgeEl.textContent = gameState.playerAge ? `${gameState.playerAge} a√±os` : '-';
      if (profileLevelEl) profileLevelEl.textContent = gameState.currentLevel || 1;
      if (profileCoinsEl) profileCoinsEl.textContent = gameState.coins || 0;
      if (profileCorrectEl) profileCorrectEl.textContent = gameState.correctAnswers || 0;
      if (profileTotalEl) profileTotalEl.textContent = gameState.totalQuestions || 0;
      
      const accuracy = gameState.totalQuestions > 0 
        ? Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100)
        : 0;
      if (profileAccuracyEl) profileAccuracyEl.textContent = `${accuracy}%`;    }

    // === EFECTOS VISUALES ===
    function showFeedback(message, type) {
      elements.feedbackMessage.textContent = message;
      elements.feedbackMessage.className = `feedback-message ${type} show`;
      
      setTimeout(() => {
        elements.feedbackMessage.classList.remove('show');
      }, 3000);
    }    function showLevelUpMessage() {
      let operationMessage = '';
      const level = gameState.currentLevel;
      
      // Mensaje espec√≠fico seg√∫n el nuevo nivel
      switch (level) {
        case 2:
          operationMessage = '<p>üÜï <strong>¬°Nueva operaci√≥n desbloqueada!</strong></p><p>üìö Ahora aprender√°s <strong>RESTAS</strong> ‚ûñ</p><p>üí° Ejemplo: 5 - 2 = ? (Respuesta: 3)</p><p>üéØ Las restas nos ayudan a quitar cantidades</p>';
          break;
        case 3:
          operationMessage = '<p>üÜï <strong>¬°Nueva operaci√≥n desbloqueada!</strong></p><p>üìö Ahora aprender√°s <strong>MULTIPLICACI√ìN</strong> ‚úñÔ∏è</p><p>üí° Ejemplo: 3 √ó 4 = ? (Respuesta: 12)</p><p>üéØ Multiplicar es sumar varias veces el mismo n√∫mero</p>';
          break;
        case 4:
          operationMessage = '<p>üÜï <strong>¬°Nueva operaci√≥n desbloqueada!</strong></p><p>üìö Ahora aprender√°s <strong>DIVISI√ìN</strong> ‚ûó</p><p>üí° Ejemplo: 12 √∑ 3 = ? (Respuesta: 4)</p><p>üéØ Dividir es repartir en partes iguales</p>';
          break;
        case 5:
          operationMessage = '<p>üåü <strong>¬°Nivel Experto Desbloqueado!</strong></p><p>üéØ Ahora encontrar√°s <strong>TODAS las operaciones mezcladas</strong></p><p>‚ûï Sumas, ‚ûñ Restas, ‚úñÔ∏è Multiplicaci√≥n, ‚ûó Divisi√≥n</p><p>üí™ ¬°Ponte a prueba con el desaf√≠o completo!</p>';
          break;
        default:
          if (level > 5) {
            operationMessage = '<p>üèÜ <strong>¬°Eres un Maestro de las Matem√°ticas!</strong></p><p>üí™ Operaciones mezcladas con mayor dificultad</p><p>üöÄ ¬°Sigue super√°ndote!</p>';
          }
      }
      
      elements.levelUpMessage.innerHTML = `
        <div class="level-up-content">
          <h2>üéâ ¬°NIVEL ${gameState.currentLevel} ALCANZADO! üéâ</h2>
          <p>¬°Excelente trabajo superando el nivel anterior!</p>
          ${operationMessage}
          <p>üéÅ +${gameState.currentLevel * 50} monedas de bonificaci√≥n</p>
          <p>‚ù§Ô∏è +1 coraz√≥n recuperado</p>
          <p><small>¬°Prep√°rate para el siguiente desaf√≠o!</small></p>
        </div>
      `;
      elements.levelUpMessage.classList.add('show');
      
      createParticleEffect('levelup');
      
      setTimeout(() => {
        elements.levelUpMessage.classList.remove('show');
      }, 4000); // M√°s tiempo para leer
    }

    function addQuestionAnimation() {
      elements.questionText.classList.remove('bounce-in');
      setTimeout(() => {
        elements.questionText.classList.add('bounce-in');
      }, 50);
    }

    function createParticleEffect(type) {
      const container = document.body;
      const colors = {
        success: ['#4CAF50', '#8BC34A', '#CDDC39'],
        error: ['#F44336', '#FF5722', '#FF9800'],
        levelup: ['#9C27B0', '#E91E63', '#2196F3', '#00BCD4']
      };
      
      const particleColors = colors[type] || colors.success;
      
      for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.className = `magic-particle ${type}`;
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.animationDelay = `${Math.random() * 0.5}s`;
        particle.style.backgroundColor = particleColors[Math.floor(Math.random() * particleColors.length)];
        
        container.appendChild(particle);
        
        setTimeout(() => {
          particle.remove();
        }, 3000);
      }
    }

    function createFloatingElements() {
      const container = document.querySelector('.floating-elements');
      const elements = ['üåü', '‚≠ê', 'üéà', 'üéâ', 'üåô', '‚òÅÔ∏è', 'ü¶ã', 'üå∏'];
      
      setInterval(() => {
        if (document.querySelectorAll('.floating-element').length < 8) {
          const element = document.createElement('div');
          element.className = 'floating-element';
          element.textContent = elements[Math.floor(Math.random() * elements.length)];
          element.style.left = `${Math.random() * 100}vw`;
          element.style.animationDuration = `${15 + Math.random() * 10}s`;
          
          container.appendChild(element);
          
          setTimeout(() => {
            element.remove();
          }, 25000);
        }
      }, 3000);
    }

    // === VALIDACI√ìN DE FORMULARIO ===
    function validateForm() {
      const name = elements.kidName.value.trim();
      const age = elements.kidAge.value;
      
      elements.startGameBtn.disabled = !name || !age;
      
      if (name && age) {
        elements.startGameBtn.classList.add('ready');
      } else {
        elements.startGameBtn.classList.remove('ready');
      }
    }

    // === GESTI√ìN DE DATOS ===
    function saveGameData() {
      localStorage.setItem('edukids_gamestate', JSON.stringify(gameState));
    }

    function loadGameData() {
      const saved = localStorage.getItem('edukids_gamestate');
      if (saved) {
        gameState = { ...gameState, ...JSON.parse(saved) };
      }
    }

    function resetProgress() {
      if (confirm('¬øEst√°s seguro de que quieres reiniciar todo tu progreso? Esta acci√≥n no se puede deshacer.')) {
        localStorage.removeItem('edukids_gamestate');
        gameState = {
          playerName: '',
          playerAge: 0,
          currentLevel: 1,
          currentQuestion: 1,
          questionsPerLevel: 10,
          hearts: 3,
          coins: 0,
          combo: 0,
          correctAnswers: 0,
          totalQuestions: 0,
          currentAnswer: 0,
          questionType: 'addition',
          difficulty: 1,
          isMultipleChoice: false
        };
        
        showScreen('register');
        elements.kidName.value = '';
        elements.kidAge.value = '';
        validateForm();
        
        showFeedback('üîÑ Progreso reiniciado exitosamente', 'info');
      }
    }

    // === FUNCIONES UTILITARIAS ===
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // === EVENTOS DE TECLADO GLOBALES ===
    document.addEventListener('keydown', function(e) {
      // Atajos de teclado solo en la pantalla de juego
      if (screens.game.style.display !== 'none') {
        switch(e.key) {
          case 'h':
          case 'H':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              showHint();
            }
            break;
          case 's':
          case 'S':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              skipQuestion();
            }
            break;
          case 'p':
          case 'P':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              showScreen('profile');
            }
            break;
        }
      }
    });
  </script>
</body>
</html>
